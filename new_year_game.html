<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –•–∞–æ—Å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #ffd700; --success: #51cf66; --lime: #9acd32; --bg-dark: #0f1729; }
        body { font-family: 'Fredoka', sans-serif; background: var(--tg-theme-bg-color, var(--bg-dark)); color: var(--tg-theme-text-color, #ffffff); min-height: 100vh; overflow-x: hidden; position: relative; }
        .starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 3s infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; } 50% { opacity: 1; } }
        .snowflake { position: absolute; color: white; font-size: 1em; opacity: 0.8; animation: fall linear infinite; z-index: 1; }
        @keyframes fall { to { transform: translateY(100vh); } }
        .container { position: relative; z-index: 2; max-width: 600px; margin: 0 auto; padding: 20px; }
        .screen { display: none; }
        .screen.active { display: block; animation: screenSlideIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        @keyframes screenSlideIn { from { opacity: 0; transform: scale(0.8) translateY(50px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .start-content { text-align: center; padding: 40px 20px; }
        .game-title { font-size: 3.5em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffa500, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 20px; animation: titleGlow 2s ease-in-out infinite; }
        @keyframes titleGlow { 0%, 100% { filter: brightness(1) drop-shadow(0 0 20px rgba(255, 215, 0, 0.6)); } 50% { filter: brightness(1.3) drop-shadow(0 0 40px rgba(255, 215, 0, 0.9)); } }
        .santa-icon { font-size: 6em; margin: 20px 0; display: inline-block; animation: santaBounce 1.5s ease-in-out infinite; }
        @keyframes santaBounce { 0%, 100% { transform: translateY(0) rotate(0deg); } 25% { transform: translateY(-25px) rotate(-5deg); } 75% { transform: translateY(-15px) rotate(5deg); } }
        .story { background: linear-gradient(135deg, rgba(26, 39, 68, 0.8), rgba(15, 23, 41, 0.9)); border-radius: 25px; padding: 30px; margin: 30px 0; border: 2px solid rgba(255, 215, 0, 0.3); }
        .story p { line-height: 1.9; margin-bottom: 15px; font-size: 1.15em; }
        .goal-box { background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.15)); border: 3px solid var(--primary); border-radius: 20px; padding: 25px; margin: 25px 0; box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); animation: goalPulse 3s ease-in-out infinite; }
        @keyframes goalPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        .goal-number { font-size: 4em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffed4e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .tg-button { background: linear-gradient(135deg, var(--tg-theme-button-color, #ffd700), #ffa500); color: var(--tg-theme-button-text-color, #000); border: none; padding: 18px 50px; font-size: 1.3em; font-weight: 700; border-radius: 50px; cursor: pointer; font-family: 'Fredoka', sans-serif; box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4); transition: all 0.3s; }
        .tg-button:active { transform: scale(0.95); }
        .progress-section { background: linear-gradient(135deg, rgba(26, 39, 68, 0.9), rgba(15, 23, 41, 0.95)); border-radius: 25px; padding: 25px; margin-bottom: 20px; border: 2px solid rgba(255, 215, 0, 0.2); }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .progress-text { font-size: 1.2em; font-weight: 700; }
        .progress-bar { width: 100%; height: 35px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #ffa500, #ff8c00); transition: width 0.8s; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #000; font-size: 1.1em; }
        .task-card { background: linear-gradient(135deg, rgba(26, 39, 68, 0.95), rgba(15, 23, 41, 1)); border-radius: 30px; padding: 35px; text-align: center; border: 3px solid rgba(255, 215, 0, 0.4); min-height: 280px; display: flex; flex-direction: column; justify-content: center; margin: 25px 0; }
        .task-card.flipping { animation: cardFlip 0.8s; }
        @keyframes cardFlip { 0% { transform: rotateY(0deg); } 50% { transform: rotateY(180deg); opacity: 0.5; } 100% { transform: rotateY(360deg); } }
        .task-card.success-flash { animation: successPulse 1s ease-out; }
        @keyframes successPulse { 0% { background: linear-gradient(135deg, rgba(81, 207, 102, 0.5), rgba(67, 233, 123, 0.5)); border-color: var(--success); } 100% { background: linear-gradient(135deg, rgba(26, 39, 68, 0.95), rgba(15, 23, 41, 1)); } }
        .task-type { display: inline-block; padding: 10px 25px; border-radius: 30px; font-size: 1em; font-weight: 700; margin-bottom: 20px; }
        .type-explain { background: linear-gradient(135deg, #667eea, #764ba2); }
        .type-show { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .type-sing { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .type-improv { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .task-text { font-size: 2em; font-weight: 700; line-height: 1.3; margin: 25px 0; }
        .timer { font-size: 3.5em; font-weight: 700; color: var(--primary); margin: 20px 0; }
        .timer.warning { color: #ff6b6b; animation: timerPanic 0.3s ease-in-out infinite; }
        @keyframes timerPanic { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        .action-buttons { display: flex; gap: 15px; margin-top: 25px; }
        .action-buttons button { flex: 1; padding: 18px; font-size: 1.15em; border-radius: 50px; border: none; font-family: 'Fredoka', sans-serif; font-weight: 700; cursor: pointer; }
        .btn-success { background: linear-gradient(135deg, var(--success), #43e97b); color: white; }
        .btn-skip { background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); color: white; border: 2px solid rgba(255, 255, 255, 0.2) !important; }
        .success-particle { position: fixed; font-size: 2.5em; pointer-events: none; z-index: 10000; animation: particleExplode 1.2s forwards; }
        @keyframes particleExplode { 0% { opacity: 1; transform: translate(0, 0) scale(0.5); } 50% { opacity: 1; transform: translate(var(--tx), var(--ty)) scale(1.5); } 100% { opacity: 0; transform: translate(calc(var(--tx) * 1.5), calc(var(--ty) * 2)) scale(0.5); } }
        .handoff-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(15, 23, 41, 0.98), rgba(26, 39, 68, 0.98)); z-index: 9999; display: none; align-items: center; justify-content: center; }
        .handoff-overlay.active { display: flex !important; }
        .handoff-content { text-align: center; padding: 40px; max-width: 500px; }
        .handoff-emoji { font-size: 7em; margin: 20px 0; animation: handPass 1.5s ease-in-out infinite; }
        @keyframes handPass { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-30px); } 75% { transform: translateX(30px); } }
        .handoff-title { font-size: 3em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffa500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 20px 0; }
        .handoff-text { font-size: 1.4em; line-height: 1.6; margin: 25px 0; }
        .handoff-button { background: linear-gradient(135deg, var(--success), #43e97b) !important; color: white !important; font-size: 1.5em !important; padding: 22px 70px !important; margin-top: 30px !important; }
        .victory-content { text-align: center; padding: 20px; }
        .victory-title { font-size: 3em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffa500, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 25px 0; }
        .gift-reveal { margin: 50px 0; position: relative; height: 400px; }
        .gift-box { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); animation: giftShake 2.5s; }
        @keyframes giftShake { 0%, 100% { transform: translate(-50%, -50%) rotate(0deg); } 10%, 30%, 50%, 70%, 90% { transform: translate(-50%, -50%) rotate(-8deg); } 20%, 40%, 60%, 80% { transform: translate(-50%, -50%) rotate(8deg); } }
        .gift-lid { width: 160px; height: 60px; background: linear-gradient(135deg, #dc3545, #c82333); border-radius: 15px 15px 0 0; position: relative; animation: lidFly 1.5s 2.5s forwards; }
        .gift-lid::before { content: 'üéÄ'; position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 3em; }
        @keyframes lidFly { 0% { transform: rotateX(0deg) translateY(0); opacity: 1; } 100% { transform: rotateX(-180deg) translateY(-300px); opacity: 0; } }
        .gift-body { width: 160px; height: 140px; background: linear-gradient(135deg, #ffd700, #ffed4e, #ffa500); border-radius: 0 0 15px 15px; animation: boxExplode 1s 2.5s forwards; }
        @keyframes boxExplode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0.2); opacity: 0; } }
        .lime-surprise { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%) scale(0); animation: limeReveal 2s 3.5s forwards; }
        @keyframes limeReveal { 0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; } 100% { transform: translate(-50%, -50%) scale(1) rotate(360deg); opacity: 1; } }
        .lime-image { width: 280px; height: 280px; animation: limeMegaPulse 2.5s ease-in-out 5.5s infinite; }
        @keyframes limeMegaPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        .congratulations-text { opacity: 0; animation: textMassiveSlide 1.5s 5.5s forwards; margin: 40px 0; }
        @keyframes textMassiveSlide { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .practical-ai-message { background: linear-gradient(135deg, rgba(154, 205, 50, 0.25), rgba(50, 205, 50, 0.25)); border-radius: 25px; padding: 30px; border: 4px solid var(--lime); }
        .practical-ai-message p { margin: 12px 0; line-height: 1.7; font-size: 1.1em; }
        .practical-ai-message strong { color: #adff2f; font-size: 1.25em; }
        .highlight-practical-ai { display: block; font-size: 1.4em !important; font-weight: 700 !important; color: #adff2f !important; margin: 20px 0 !important; }
        .lemonade-text { font-style: italic; font-size: 1.2em !important; color: #ffed4e !important; }
        .final-celebration { font-size: 2em; font-weight: 700; font-family: 'Caveat', cursive; background: linear-gradient(135deg, #ffd700, #ffa500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 30px 0; opacity: 0; animation: celebrationMega 1.5s 7s forwards; }
        @keyframes celebrationMega { 0% { opacity: 0; transform: scale(0.2); } 100% { opacity: 1; transform: scale(1); } }
        @keyframes fadeInText { from { opacity: 0; } to { opacity: 1; } }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 20px; margin: 35px 0; }
        .stat-card { background: linear-gradient(135deg, rgba(26, 39, 68, 0.8), rgba(15, 23, 41, 0.9)); border-radius: 20px; padding: 25px; text-align: center; border: 2px solid rgba(255, 215, 0, 0.3); }
        .stat-icon { font-size: 2.5em; margin-bottom: 10px; }
        .stat-value { font-size: 2.5em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffed4e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-label { font-size: 1em; opacity: 0.9; margin-top: 8px; }
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 10000; pointer-events: none; }
        .confetti.lime { background: var(--lime); }
        .confetti.gold { background: var(--primary); }
        @keyframes confettiFall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .gifts-title { font-size: 3em; font-weight: 700; background: linear-gradient(135deg, #9acd32, #adff2f, #7cfc00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 25px 0; text-align: center; }
        .gifts-message { background: linear-gradient(135deg, rgba(26, 39, 68, 0.9), rgba(15, 23, 41, 0.95)); border-radius: 25px; padding: 30px; margin: 25px 0; border: 3px solid var(--lime); }
        .gifts-header { font-size: 1.3em; font-weight: 700; margin-bottom: 25px; text-align: center; }
        .gifts-header strong { color: var(--lime); font-size: 1.2em; }
        .gift-item { display: flex; align-items: center; gap: 15px; padding: 18px; margin: 12px 0; background: linear-gradient(135deg, rgba(154, 205, 50, 0.1), rgba(50, 205, 50, 0.05)); border-radius: 15px; border-left: 4px solid var(--lime); }
        .gift-icon { font-size: 2.5em; min-width: 60px; text-align: center; }
        .gift-text { flex: 1; text-align: left; }
        .gift-text strong { display: block; font-size: 1.15em; margin-bottom: 5px; }
        .gift-text span { display: block; font-size: 0.9em; opacity: 0.8; }
        .how-to-get { margin: 30px 0; padding: 25px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.05)); border-radius: 20px; border: 2px solid rgba(255, 215, 0, 0.3); }
        .how-to-header { font-size: 1.3em; font-weight: 700; margin-bottom: 20px; text-align: center; color: var(--primary); }
        .step { display: flex; align-items: center; gap: 15px; margin: 15px 0; }
        .step-number { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, var(--primary), #ffa500); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2em; color: #000; flex-shrink: 0; }
        .step-text { flex: 1; font-size: 1.05em; line-height: 1.4; }
        .mega-cta { font-size: 1.2em !important; padding: 20px 45px !important; background: linear-gradient(135deg, var(--lime), #7cfc00) !important; color: #000 !important; animation: ctaPulse 2s ease-in-out infinite !important; }
        @keyframes ctaPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .channel-btn { background: linear-gradient(135deg, #0088cc, #00a0dc) !important; color: white !important; display: block; text-decoration: none; text-align: center; margin: 15px auto; }
        .dm-btn { background: linear-gradient(135deg, var(--lime), #7cfc00) !important; color: #000 !important; display: block; text-decoration: none; text-align: center; margin: 15px auto; animation: ctaPulse 2s ease-in-out infinite; }
        .new-year-message { text-align: center; margin: 40px 20px; padding: 30px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1)); border-radius: 25px; border: 3px solid #ffd700; }
        .new-year-title { font-size: 2em; font-weight: 700; background: linear-gradient(135deg, #ffd700, #ffa500, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1.3; margin: 15px 0; }
        .new-year-subtitle { font-size: 1.4em; font-weight: 600; color: #ffed4e; line-height: 1.5; }
        .final-celebration-big { font-size: 2.5em; font-weight: 700; font-family: 'Caveat', cursive; background: linear-gradient(135deg, #ffd700, #ffa500, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 30px 0; line-height: 1.3; }
        @media (max-width: 480px) { .game-title { font-size: 2.5em; } .santa-icon { font-size: 4.5em; } .task-text { font-size: 1.5em; } .timer { font-size: 3em; } .gifts-title { font-size: 2em; } .gift-icon { font-size: 2em; min-width: 50px; } .handoff-title { font-size: 2.2em; } .handoff-emoji { font-size: 5em; } }
    </style>
</head>
<body>
    <div class="starfield" id="starfield"></div>
    <div id="snowfall"></div>

    <div class="container">
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="startScreen" class="screen active">
            <div class="start-content">
                <h1 class="game-title">–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –•–∞–æ—Å</h1>
                <div class="santa-icon">üéÖ</div>
                <div class="story">
                    <p><strong>–°—Ä–æ—á–Ω–∞—è –Ω–æ–≤–æ—Å—Ç—å –∏–∑ –í–µ–ª–∏–∫–æ–≥–æ –£—Å—Ç—é–≥–∞!</strong></p>
                    <p>–î–µ–¥ –ú–æ—Ä–æ–∑ –∏ –°–Ω–µ–≥—É—Ä–æ—á–∫–∞ –≥–æ—Ç–æ–≤—è—Ç—Å—è –∫ –ù–æ–≤–æ–º—É –ì–æ–¥—É, –Ω–æ —Å–ª—É—á–∏–ª–∞—Å—å –±–µ–¥–∞ ‚Äì –ø–æ–¥–∞—Ä–∫–∏ —Ä–∞–∑–ª–µ—Ç–µ–ª–∏—Å—å –ø–æ –≤—Å–µ–º—É —Å–≤–µ—Ç—É!</p>
                    <p>–ß—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ, –Ω—É–∂–Ω–∞ –≤–∞—à–∞ –ø–æ–º–æ—â—å!</p>
                </div>
                <div class="goal-box">
                    <p style="margin-bottom: 10px; font-weight: 600;">–í–∞—à–∞ –º–∏—Å—Å–∏—è:</p>
                    <div class="goal-number">20</div>
                    <p style="margin-top: 10px; font-weight: 600;">–ø–æ–¥–∞—Ä–∫–æ–≤ –¥–æ –ù–æ–≤–æ–≥–æ –ì–æ–¥–∞!</p>
                </div>
                <p style="margin: 25px 0; font-size: 1.15em; font-weight: 600;">–ó–∞ –∫–∞–∂–¥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫. –î–µ–π—Å—Ç–≤—É–π—Ç–µ –±—ã—Å—Ç—Ä–æ ‚Äì –≤—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ! ‚è∞</p>
                <button class="tg-button" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="gameScreen" class="screen">
            <div class="progress-section">
                <div class="progress-header">
                    <span class="progress-text"><span id="giftsCount">0</span> / 20 üéÅ</span>
                    <span id="streakDisplay" style="font-size: 1em; font-weight: 700;">üî• 0</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"><span id="progressPercent">0%</span></div>
                </div>
            </div>
            <div class="task-card" id="taskCard">
                <span class="task-type" id="taskType">–û–±—ä—è—Å–Ω–∏</span>
                <div class="task-text" id="taskText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="timer" id="timer">60</div>
                <div class="action-buttons">
                    <button class="btn-success" onclick="taskSuccess()">‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
                    <button class="btn-skip" onclick="skipTask()">‚Üí –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã -->
        <div id="victoryScreen" class="screen">
            <div class="victory-content">
                <h2 class="victory-title">üéâ –ü–æ–±–µ–¥–∞! üéâ</h2>
                <div class="gift-reveal">
                    <div class="gift-box">
                        <div class="gift-lid"></div>
                        <div class="gift-body"></div>
                    </div>
                    <div class="lime-surprise">
                        <div style="font-size: 180px;">üçã</div>
                    </div>
                </div>
                <div class="congratulations-text">
                    <div class="practical-ai-message">
                        <p><strong>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –æ—Ç–ª–∏—á–Ω–æ –∏–≥—Ä–∞–ª–∏!</strong></p>
                        <p style="margin-top: 10px;">–î–µ–¥ –ú–æ—Ä–æ–∑ –∏ –°–Ω–µ–≥—É—Ä–æ—á–∫–∞ –±–ª–∞–≥–æ–¥–∞—Ä—è—Ç –≤–∞—Å –∑–∞ –ø–æ–º–æ—â—å.</p>
                        <p class="highlight-practical-ai">‚≠ê –ö–æ–º–∞–Ω–¥–∞ Practical AI –ø–æ–∑–¥—Ä–∞–≤–ª—è–µ—Ç –≤–∞—Å —Å –Ω–∞—Å—Ç—É–ø–∞—é—â–∏–º –ù–æ–≤—ã–º –ì–æ–¥–æ–º! ‚≠ê</p>
                        <p class="lemonade-text">–ï—Å–ª–∏ –≤–∞–º –ø–æ–ø–∞–¥–µ—Ç—Å—è –ª–∏–º–æ–Ω –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É, —Å–¥–µ–ª–∞–π—Ç–µ –∏–∑ –Ω–µ–≥–æ –õ–∏–º–æ–Ω–∞–¥! üçã‚ú®</p>
                    </div>
                </div>
                <div class="final-celebration">–ê —Ç–µ–ø–µ—Ä—å –∑–∞–±–∏—Ä–∞–π—Ç–µ –≤–∞—à –ø–æ–¥–∞—Ä–æ–∫! üéÅ</div>
                <button class="tg-button" style="margin-top: 30px; opacity: 0; animation: fadeInText 1s ease-in 6.5s forwards; font-size: 1.3em; padding: 20px 50px;" onclick="document.getElementById('victoryScreen').classList.remove('active'); document.getElementById('giftsScreen').classList.add('active'); if(window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');">üéÅ –ó–∞–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫ ‚Üí</button>
            </div>
        </div>

        <!-- –≠–ö–†–ê–ù –ü–û–î–ê–†–ö–û–í - –û–ë–ù–û–í–õ–Å–ù–ù–´–ô -->
        <div id="giftsScreen" class="screen">
            <div class="victory-content">
                <h2 class="gifts-title">üéÅ –í–∞—à –ø–æ–¥–∞—Ä–æ–∫!</h2>
                <div style="font-size: 4em; margin: 20px 0;">üçã</div>
                
                <div class="gifts-message">
                    <p class="gifts-header">üçã <strong>Practical AI</strong> –¥–∞—Ä–∏—Ç –≤–∞–º –ø–∞–∫–µ—Ç –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ —Å AI:</p>
                    
                    <div class="gift-item">
                        <div class="gift-icon">üéØ</div>
                        <div class="gift-text">
                            <strong>AI-—Å—Ç—Ä–∞—Ç—Å–µ—Å—Å–∏—è (30 –º–∏–Ω—É—Ç)</strong>
                            <span>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ + –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è AI</span>
                        </div>
                    </div>
                    
                    <div class="gift-item">
                        <div class="gift-icon">üìä</div>
                        <div class="gift-text">
                            <strong>–ö–µ–π—Å—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è AI</strong>
                            <span>–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã: +42% –ø—Ä–æ–¥–∞–∂, 82% —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏</span>
                        </div>
                    </div>
                    
                    <div class="gift-item">
                        <div class="gift-icon">üéì</div>
                        <div class="gift-text">
                            <strong>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —É—Ä–æ–∫ –ø–æ –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç—è—Ö</strong>
                            <span>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≥–∞–π–¥ —Å –≥–æ—Ç–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏</span>
                        </div>
                    </div>
                    
                    <div class="gift-item">
                        <div class="gift-icon">üé•</div>
                        <div class="gift-text">
                            <strong>–í–∏–¥–µ–æ-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É</strong>
                            <span>–ü–æ—à–∞–≥–æ–≤–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –≤–∞—à –±–∏–∑–Ω–µ—Å</span>
                        </div>
                    </div>
                    
                    <div class="gift-item">
                        <div class="gift-icon">‚ö°</div>
                        <div class="gift-text">
                            <strong>–ù–∞–±–æ—Ä –≥–æ—Ç–æ–≤—ã—Ö AI-–ø—Ä–æ–º—Ç–æ–≤</strong>
                            <span>ChatGPT, Claude, Perplexity –¥–ª—è –≤–∞—à–µ–π –Ω–∏—à–∏</span>
                        </div>
                    </div>
                    
                    <div class="how-to-get">
                        <p class="how-to-header">üíé –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –í–°–ï –ø–æ–¥–∞—Ä–∫–∏:</p>
                        
                        <div class="step">
                            <div class="step-number">1</div>
                            <div class="step-text">–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –Ω–∞—à –∫–∞–Ω–∞–ª, —á—Ç–æ–±—ã —É–∑–Ω–∞–≤–∞—Ç—å –±–æ–ª—å—à–µ –æ–± AI</div>
                        </div>
                        
                        <a href="https://t.me/practicalaicommunity" target="_blank" class="tg-button channel-btn" style="padding: 15px 30px; font-size: 1.1em;">
                            üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª
                        </a>
                        
                        <div class="step">
                            <div class="step-number">2</div>
                            <div class="step-text">–ù–∞–ø–∏—à–∏—Ç–µ –≤ –ª–∏—á–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏:</div>
                        </div>
                        
                        <a href="https://t.me/Danil_alto" target="_blank" class="tg-button dm-btn" style="padding: 18px 35px; font-size: 1.2em;">
                            üéÅ –ù–∞–ø–∏—Å–∞—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏ ‚Üí
                        </a>
                        <p style="text-align: center; opacity: 0.7; font-size: 0.9em;">@Danil_alto</p>
                    </div>
                </div>
                
                <!-- –ù–û–í–û–ì–û–î–ù–ï–ï –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–ï -->
                <div class="new-year-message">
                    <div style="font-size: 3em; margin-bottom: 15px;">üéÑ‚ú®üéÖ</div>
                    <h2 class="new-year-title">–°—á–∞—Å—Ç–ª–∏–≤–æ–≥–æ –ù–æ–≤–æ–≥–æ –ì–æ–¥–∞!</h2>
                    <p class="new-year-subtitle">
                        –î–∞—Ä–∏—Ç–µ –¥—Ä—É–≥ –¥—Ä—É–≥—É<br/>
                        <span style="font-size: 1.2em;">‚ù§Ô∏è –ª—é–±–æ–≤—å –∏ –∑–∞–±–æ—Ç—É ‚ù§Ô∏è</span>
                    </p>
                    <p style="margin-top: 15px; font-size: 1.1em; opacity: 0.9; font-style: italic;">
                        –°–∞–º—ã–µ —Ü–µ–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ ‚Äî —ç—Ç–æ —Ç–µ,<br/>–∫–æ—Ç–æ—Ä—ã–µ –º—ã –¥–∞—Ä–∏–º –¥—Ä—É–≥ –¥—Ä—É–≥—É —Å–∞–º–∏ üéÅ
                    </p>
                </div>
                
                <button class="tg-button" style="margin-top: 20px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); border: 2px solid rgba(255, 255, 255, 0.3);" onclick="showFinalScreen()">
                    üéÑ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏ ‚Üí
                </button>
            </div>
        </div>

        <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="finalScreen" class="screen">
            <div class="victory-content">
                <div class="final-celebration-big">–ê —Ç–µ–ø–µ—Ä—å –≤—Ä–µ–º—è<br>–¥–∞—Ä–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏! üéÅ</div>
                <div style="font-size: 4em; margin: 30px 0;">üéÖ üéÑ ‚õÑ</div>
                <p style="font-size: 1.2em; margin: 20px 0; line-height: 1.6;">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∏–≥—Ä–æ–π —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –∫–æ–ª–ª–µ–≥–∞–º–∏!<br>–ü—É—Å—Ç—å –≤—Å–µ —Å–æ–±–µ—Ä—É—Ç –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞!</p>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon">üéØ</div><div class="stat-value" id="finalTasks">0</div><div class="stat-label">–ó–∞–¥–∞–Ω–∏–π</div></div>
                    <div class="stat-card"><div class="stat-icon">üî•</div><div class="stat-value" id="finalStreak">0</div><div class="stat-label">–õ—É—á—à–∞—è —Å–µ—Ä–∏—è</div></div>
                    <div class="stat-card"><div class="stat-icon">üéÅ</div><div class="stat-value">20</div><div class="stat-label">–ü–æ–¥–∞—Ä–∫–æ–≤</div></div>
                </div>
                <button class="tg-button" style="margin-top: 25px;" onclick="shareResults()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
                <button class="tg-button" style="margin-top: 12px; background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.05)); border: 2px solid rgba(255, 255, 255, 0.3);" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                <p style="opacity: 0.7; margin-top: 30px; font-size: 0.9em;">–ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–æ–π <strong>Practical AI</strong><br><a href="https://t.me/practicalaicommunity" target="_blank" style="color: #9acd32;">@practicalaicommunity</a></p>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
    <div id="handoffOverlay" class="handoff-overlay">
        <div class="handoff-content">
            <div class="handoff-emoji">üì±‚û°Ô∏èüë§</div>
            <h2 class="handoff-title">–ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω!</h2>
            <p class="handoff-text">–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç<br><strong style="color: var(--primary);">–¥—Ä—É–≥–æ–π —á–µ–ª–æ–≤–µ–∫</strong></p>
            <div style="font-size: 3.5em; margin: 15px 0; color: var(--primary);">‚¨áÔ∏è</div>
            <button class="tg-button handoff-button" onclick="continueGame()">‚úÖ –ü–µ—Ä–µ–¥–∞–ª! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        if (tg) { tg.ready(); tg.expand(); tg.setHeaderColor('secondary_bg_color'); }

        function createStars() {
            const starfield = document.getElementById('starfield');
            for (let i = 0; i < 120; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = size + 'px';
                star.style.height = size + 'px';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starfield.appendChild(star);
            }
        }

        function createSnowflakes() {
            const snowfall = document.getElementById('snowfall');
            const flakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 40; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = flakes[Math.floor(Math.random() * flakes.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDuration = (Math.random() * 3 + 4) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.fontSize = (Math.random() * 0.5 + 0.8) + 'em';
                snowfall.appendChild(snowflake);
            }
        }

        createStars();
        createSnowflakes();

        const taskPools = {
            explain: ["–Å–ª–∫–∞", "–°–Ω–µ–≥", "–ü–æ–¥–∞—Ä–æ–∫", "–î–µ–¥ –ú–æ—Ä–æ–∑", "–°–Ω–µ–≥—É—Ä–æ—á–∫–∞", "–ì–∏—Ä–ª—è–Ω–¥–∞", "–ú–∞–Ω–¥–∞—Ä–∏–Ω", "–§–µ–π–µ—Ä–≤–µ—Ä–∫", "–°–∞–Ω–∏", "–û–ª–µ–Ω—å", "–°–Ω–µ–≥–æ–≤–∏–∫", "–ö–∞–º–∏–Ω", "–ù–æ—Å–æ–∫", "–ó–≤–µ–∑–¥–∞", "–®–∞–º–ø–∞–Ω—Å–∫–æ–µ", "–ë–µ–Ω–≥–∞–ª—å—Å–∫–∏–π –æ–≥–æ–Ω—å", "–ú–∏—à—É—Ä–∞", "–ö–∞–ª–µ–Ω–¥–∞—Ä—å", "–ö—É—Ä–∞–Ω—Ç—ã", "–°–∞–ª–∞—Ç –æ–ª–∏–≤—å–µ", "–®–∞—Ä–∏–∫", "–ò–≥–æ–ª–∫–∏", "–ö–æ–Ω—Ñ–µ—Ç—Ç–∏", "–°–µ—Ä–ø–∞–Ω—Ç–∏–Ω", "–ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫", "–í–∞—Ä–µ–∂–∫–∏", "–í–∞–ª–µ–Ω–∫–∏", "–°–Ω–µ–∂–∏–Ω–∫–∞", "–ü–æ—Å–æ—Ö", "–ë—É–±–µ–Ω—Ü—ã", "–ò–≥—Ä—É—à–∫–∞", "–ú–µ—à–æ–∫", "–®–∏—à–∫–∞", "–•–ª–æ–ø—É—à–∫–∞", "–õ–µ–¥—è–Ω–∫–∞", "–°–æ—Å—É–ª—å–∫–∞", "–°–∞–Ω–∫–∏", "–ö–æ–Ω—å–∫–∏", "–õ—ã–∂–∏", "–°–Ω–µ–∂–Ω–∞—è –±–∞–±–∞", "–ó–∏–º–∞", "–ú–µ—Ç–µ–ª—å", "–í—å—é–≥–∞", "–ú–æ—Ä–æ–∑", "–•–æ–ª–æ–¥", "–†–∞–¥–æ—Å—Ç—å", "–°–º–µ—Ö", "–°—é—Ä–ø—Ä–∏–∑", "–£–¥–∞—á–∞", "–ú–µ—á—Ç–∞"],
            show: ["–¢—ã –∑–∞–≤–∞—Ä–∏–≤–∞–µ—à—å –∫–æ—Ñ–µ —Ä–∞–Ω–æ —É—Ç—Ä–æ–º", "–¢—ã —Å—Ç–æ–∏—à—å –≤ –ø—Ä–æ–±–∫–µ", "–¢—ã –∏—â–µ—à—å –∫–ª—é—á–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º", "–¢—ã –Ω–∞—á–∞–ª—å–Ω–∏–∫ –Ω–∞ –ø–ª–∞–Ω–µ—Ä–∫–µ", "–¢—ã –Ω–∞ —Å—Ç—Ä–æ–≥–æ–π –¥–∏–µ—Ç–µ –ø–µ—Ä–µ–¥ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º", "–¢—ã –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –≤ —Å–ø–æ—Ä—Ç–∑–∞–ª–µ", "–¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É –≤–ø–æ–ø—ã—Ö–∞—Ö", "–¢—ã –ø—ã—Ç–∞–µ—à—å—Å—è –≤—Å–ø–æ–º–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å", "–¢—ã –∑–∞–Ω–∏–º–∞–µ—à—å—Å—è –π–æ–≥–æ–π –¥–æ–º–∞", "–¢—ã –Ω–∞ —Å–∞–º–æ–∏–∑–æ–ª—è—Ü–∏–∏ —É–∂–µ –º–µ—Å—è—Ü", "–¢—ã —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä –≤ –ø–∏–∂–∞–º–µ –Ω–∞ —Ä–∞–±–æ—Ç–µ", "–¢—ã –Ω–∞ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–µ –≤ Zoom", "–¢—ã –≤—ã–±–∏—Ä–∞–µ—à—å —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ Netflix", "–¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å –º–µ–±–µ–ª—å –∏–∑ IKEA", "–¢—ã –±–∞—Ä–∞–±–∞–Ω—â–∏–∫ —Ä–æ–∫-–≥—Ä—É–ø–ø—ã", "–¢—ã –¥–∏–¥–∂–µ–π –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫–µ", "–¢—ã –Ω–∞ –±–µ–≥–æ–≤–æ–π –¥–æ—Ä–æ–∂–∫–µ", "–¢—ã –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä –∑–∞ —Ä–∞–±–æ—Ç–æ–π", "–¢—ã –º–∞—Å—Å–∞–∂–∏—Å—Ç", "–¢—ã –±–∞—Ä–º–µ–Ω –¥–µ–ª–∞–µ—à—å –∫–æ–∫—Ç–µ–π–ª—å", "–¢—ã –ø–æ—Ç–µ—Ä—è–ª —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∏—â–µ—à—å –µ–≥–æ", "–¢—ã —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ –¥–ª—è Instagram", "–¢—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å TikTok", "–¢—ã –±–ª–æ–≥–µ—Ä –Ω–∞ –ø—Ä—è–º–æ–º —ç—Ñ–∏—Ä–µ"],
            sing: ["–í –ª–µ—Å—É —Ä–æ–¥–∏–ª–∞—Å—å —ë–ª–æ—á–∫–∞", "Jingle Bells", "–° –Ω–æ–≤—ã–º –≥–æ–¥–æ–º!", "–ú–∞–ª–µ–Ω—å–∫–æ–π —ë–ª–æ—á–∫–µ —Ö–æ–ª–æ–¥–Ω–æ –∑–∏–º–æ–π", "–¢—Ä–∏ –±–µ–ª—ã—Ö –∫–æ–Ω—è", "–†–∞—Å—Å–∫–∞–∂–∏, –°–Ω–µ–≥—É—Ä–æ—á–∫–∞", "Last Christmas", "Happy New Year", "–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–µ —Å–Ω–µ–∂–∏–Ω–∫–∏", "Let It Snow", "–ö–∞–±—ã –Ω–µ –±—ã–ª–æ –∑–∏–º—ã", "–ù–æ–≤–æ–≥–æ–¥–Ω—è—è", "We Wish You a Merry Christmas"],
            improv: ["–†–∞—Å—Å–∫–∞–∂–∏, –æ —á—ë–º –º–µ—á—Ç–∞–µ—Ç —Å–Ω–µ–∂–∏–Ω–∫–∞", "–ü–æ–∑–¥—Ä–∞–≤—å –≤—Å–µ—Ö –æ—Ç –∏–º–µ–Ω–∏ —ë–ª–æ—á–Ω–æ–π –∏–≥—Ä—É—à–∫–∏", "–ü–æ–∫–∞–∂–∏ —Ç–∞–Ω–µ—Ü —Å–Ω–µ–≥–æ–≤–∏–∫–∞", "–°–∫–∞–∂–∏ —Ç–æ—Å—Ç –∫–∞–∫ –î–µ–¥ –ú–æ—Ä–æ–∑", "–ò–∑–æ–±—Ä–∞–∑–∏ –∫–∞–∫ –º–∞–Ω–¥–∞—Ä–∏–Ω —Ö–æ—á–µ—Ç —É–±–µ–∂–∞—Ç—å —Å–æ —Å—Ç–æ–ª–∞", "–†–∞—Å—Å–∫–∞–∂–∏ –∏—Å—Ç–æ—Ä–∏—é –æ–¥–Ω–æ–π –≥–∏—Ä–ª—è–Ω–¥—ã", "–ü–æ–∫–∞–∂–∏ –∫–∞–∫ —Å–Ω–µ–∂–∏–Ω–∫–∞ –ø–∞–¥–∞–µ—Ç —Å –Ω–µ–±–∞", "–ò–∑–æ–±—Ä–∞–∑–∏ —Å–Ω–µ–≥–æ–≤–∏–∫–∞ –Ω–∞ –ø–ª—è–∂–µ", "–°—Ç–∞–Ω—Ü—É–π —Ç–∞–Ω–µ—Ü —Å–Ω–µ–∂–Ω–æ–π –±—É—Ä–∏", "–ü–æ–∫–∞–∂–∏ –∫–∞–∫ –ø–æ–¥–∞—Ä–æ–∫ –Ω–µ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã –µ–≥–æ –æ—Ç–∫—Ä—ã–≤–∞–ª–∏", "–†–∞—Å—Å–∫–∞–∂–∏ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ –∂–µ–ª–∞–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–∞", "–ò–∑–æ–±—Ä–∞–∑–∏ —ë–ª–∫—É, –∫–æ—Ç–æ—Ä–∞—è –±–æ–∏—Ç—Å—è –≥–∏—Ä–ª—è–Ω–¥", "–ü–æ–∫–∞–∂–∏ –∫–∞–∫ –°–Ω–µ–≥—É—Ä–æ—á–∫–∞ —É—á–∏—Ç —Å–Ω–µ–≥–æ–≤–∏–∫–æ–≤ —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å", "–†–∞—Å—Å–∫–∞–∂–∏ —Å–∫–∞–∑–∫—É –ø—Ä–æ —Ö—Ä–∞–±—Ä–æ–≥–æ —Å–Ω–µ–≥–æ–≤–∏–∫–∞", "–ò–∑–æ–±—Ä–∞–∑–∏ –æ–ª–µ–Ω—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ –≤ –æ—Ç–ø—É—Å–∫–µ"]
        };

        const usedTasks = { explain: new Set(), show: new Set(), sing: new Set(), improv: new Set() };
        let totalTasks = 0, giftsCollected = 0, currentStreak = 0, bestStreak = 0, timerInterval = null, timeLeft = 60, isTimerRunning = false;
        const GOAL = 20;

        function getUniqueTask(type) {
            const pool = taskPools[type];
            const used = usedTasks[type];
            if (used.size >= pool.length) used.clear();
            let task, attempts = 0;
            do { task = pool[Math.floor(Math.random() * pool.length)]; attempts++; } while (used.has(task) && attempts < 100);
            used.add(task);
            return task;
        }

        function startGame() {
            document.getElementById('startScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            newTask();
        }

        function newTask() {
            const types = ['explain', 'show', 'sing', 'improv'];
            const type = types[Math.floor(Math.random() * types.length)];
            const task = getUniqueTask(type);
            const card = document.getElementById('taskCard');
            const taskTypeEl = document.getElementById('taskType');
            const taskTextEl = document.getElementById('taskText');
            card.classList.add('flipping');
            setTimeout(() => {
                taskTypeEl.className = 'task-type type-' + type;
                const typeNames = { 'explain': 'üó£Ô∏è –û–±—ä—è—Å–Ω–∏', 'show': 'üé≠ –ü–æ–∫–∞–∂–∏', 'sing': 'üéµ –°–ø–æ–π', 'improv': 'üé™ –ò–º–ø—Ä–æ–≤–∏–∑–∏—Ä—É–π' };
                taskTypeEl.textContent = typeNames[type];
                taskTextEl.textContent = task;
                card.classList.remove('flipping');
            }, 400);
            resetTimer();
            startTimer();
        }

        function startTimer() {
            if (isTimerRunning) return;
            isTimerRunning = true;
            timerInterval = setInterval(() => {
                timeLeft--;
                const timerEl = document.getElementById('timer');
                timerEl.textContent = timeLeft;
                if (timeLeft <= 10) { timerEl.classList.add('warning'); if (tg?.HapticFeedback && timeLeft <= 5) tg.HapticFeedback.impactOccurred('light'); }
                else timerEl.classList.remove('warning');
                if (timeLeft <= 0) skipTask();
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            timeLeft = 60;
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('timer').classList.remove('warning');
        }

        function taskSuccess() {
            totalTasks++; giftsCollected++; currentStreak++;
            if (currentStreak > bestStreak) bestStreak = currentStreak;
            const card = document.getElementById('taskCard');
            card.classList.add('success-flash');
            setTimeout(() => card.classList.remove('success-flash'), 1000);
            createSuccessParticles();
            if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            updateProgress();
            if (giftsCollected >= GOAL) setTimeout(showVictory, 800);
            else setTimeout(showHandoff, 800);
        }

        function showHandoff() {
            document.getElementById('handoffOverlay').classList.add('active');
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        }

        function continueGame() {
            document.getElementById('handoffOverlay').classList.remove('active');
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            newTask();
        }

        function skipTask() {
            totalTasks++; currentStreak = 0;
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            showHandoff();
        }

        function createSuccessParticles() {
            const particles = ['‚ú®', '‚≠ê', 'üí´', 'üéâ', 'üéä', 'üéÅ', '‚ùÑÔ∏è'];
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'success-particle';
                particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                particle.style.left = '50%'; particle.style.top = '50%';
                const angle = (Math.PI * 2 * i) / 15;
                const distance = 100 + Math.random() * 50;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1200);
            }
        }

        function updateProgress() {
            const progress = (giftsCollected / GOAL) * 100;
            document.getElementById('giftsCount').textContent = giftsCollected;
            document.getElementById('streakDisplay').textContent = 'üî• ' + currentStreak;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
        }

        function showVictory() {
            clearInterval(timerInterval);
            document.getElementById('gameScreen').classList.remove('active');
            document.getElementById('victoryScreen').classList.add('active');
            document.getElementById('finalTasks').textContent = totalTasks;
            document.getElementById('finalStreak').textContent = bestStreak;
            if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            setTimeout(() => createMassiveConfetti(), 3500);
            setTimeout(() => createMassiveConfetti(), 5500);
        }

        function showFinalScreen() {
            document.getElementById('giftsScreen').classList.remove('active');
            document.getElementById('finalScreen').classList.add('active');
            if (tg) { tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É'); tg.MainButton.show(); tg.MainButton.onClick(() => tg.close()); }
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            createMassiveConfetti();
        }

        function createMassiveConfetti() {
            for (let i = 0; i < 80; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti ' + (Math.random() > 0.5 ? 'lime' : 'gold');
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-20px';
                confetti.style.width = (Math.random() * 8 + 6) + 'px';
                confetti.style.height = confetti.style.width;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.animation = `confettiFall ${Math.random() * 3 + 3}s linear forwards`;
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 6000);
            }
        }

        function restartGame() {
            giftsCollected = 0; totalTasks = 0; currentStreak = 0; bestStreak = 0;
            for (let key in usedTasks) usedTasks[key].clear();
            updateProgress();
            document.getElementById('victoryScreen').classList.remove('active');
            document.getElementById('giftsScreen').classList.remove('active');
            document.getElementById('finalScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            if (tg?.MainButton) tg.MainButton.hide();
            if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            newTask();
        }

        function shareResults() {
            const text = `üéâ –Ø —Å–æ–±—Ä–∞–ª ${giftsCollected} –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–ª—è –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞!\nüî• –õ—É—á—à–∞—è —Å–µ—Ä–∏—è: ${bestStreak}\nüéØ –í—Å–µ–≥–æ –∑–∞–¥–∞–Ω–∏–π: ${totalTasks}\n\n–ü–æ–ø—Ä–æ–±—É–π –∏ —Ç—ã! üéÖ`;
            if (tg?.switchInlineQuery) tg.switchInlineQuery(text, ['users', 'groups']);
            else if (navigator.share) navigator.share({ title: '–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –•–∞–æ—Å', text: text });
            else alert('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n\n' + text);
        }
    </script>
</body>
</html>
